---
- name: "Create folder for media"
  file:
    path: "{{ media_folder }}"
    mode: "0755"
    state: "directory"

- name: "Install utilities"
  apt:
    name: "cec-utils"
  become: yes

- name: "Install VLC"
  apt:
    name: "vlc"
  become: yes

- name: "Ensure group {{ media_vlc_user }} exists"
  group:
    name: "{{ media_vlc_user }}"
    state: "present"
  become: yes

- name: "Add the user for VLC"
  user:
    comment: "VLC daemon"
    name: "{{ media_vlc_user }}"
    group: "{{ media_vlc_user }}"
    groups:
      - "audio"
      - "video"
    append: yes
    home: "/"
    shell: "/usr/bin/nologin"
    password: "!"
    system: yes
    create_home: no
  become: yes

- name: "Copy VLC systemd"
  template:
    src: "vlc.service.j2"
    dest: "{{ systemd_directory }}/vlc.service"
    mode: "0644"
  notify: "Restart VLC"
  become: yes

- name: "Start/Enable VLC"
  systemd:
    name: "vlc"
    state: "started"
    enabled: yes
    daemon_reload: yes
  become: yes
